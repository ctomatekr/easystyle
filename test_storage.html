<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>로컬 스토리지 테스트</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-slate-900 text-white p-8">
    <h1 class="text-2xl font-bold mb-6">로컬 스토리지 유틸리티 테스트</h1>
    
    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
        <!-- Style History Test -->
        <div class="bg-slate-800 p-4 rounded-lg">
            <h2 class="text-lg font-bold mb-4">스타일 히스토리</h2>
            <button onclick="testStyleHistory()" class="bg-blue-400 text-black px-3 py-2 rounded text-sm mb-2">
                히스토리 추가
            </button>
            <button onclick="showStyleHistory()" class="bg-green-400 text-black px-3 py-2 rounded text-sm mb-2">
                히스토리 보기
            </button>
            <div id="historyResults" class="text-sm"></div>
        </div>

        <!-- Wishlist Test -->
        <div class="bg-slate-800 p-4 rounded-lg">
            <h2 class="text-lg font-bold mb-4">위시리스트</h2>
            <button onclick="testWishlist()" class="bg-purple-400 text-black px-3 py-2 rounded text-sm mb-2">
                상품 추가
            </button>
            <button onclick="showWishlist()" class="bg-pink-400 text-black px-3 py-2 rounded text-sm mb-2">
                위시리스트 보기
            </button>
            <div id="wishlistResults" class="text-sm"></div>
        </div>

        <!-- User Preferences Test -->
        <div class="bg-slate-800 p-4 rounded-lg">
            <h2 class="text-lg font-bold mb-4">사용자 설정</h2>
            <button onclick="testPreferences()" class="bg-orange-400 text-black px-3 py-2 rounded text-sm mb-2">
                설정 변경
            </button>
            <button onclick="showPreferences()" class="bg-yellow-400 text-black px-3 py-2 rounded text-sm mb-2">
                설정 보기
            </button>
            <div id="preferencesResults" class="text-sm"></div>
        </div>
    </div>

    <div class="mt-8 bg-slate-800 p-4 rounded-lg">
        <h2 class="text-lg font-bold mb-4">스토리지 정보</h2>
        <button onclick="showStorageInfo()" class="bg-amber-400 text-black px-4 py-2 rounded">
            스토리지 상태 확인
        </button>
        <div id="storageInfo" class="mt-4 text-sm"></div>
    </div>

    <script type="module">
        import { 
            styleHistoryManager, 
            wishlistManager, 
            userPreferencesManager,
            storageManager 
        } from './utils/localStorage.js';
        
        window.testStyleHistory = function() {
            const testStyle = {
                originalImage: 'data:image/jpeg;base64,test',
                styledImage: 'data:image/jpeg;base64,styled',
                description: '테스트 스타일 설명',
                prompt: '테스트 프롬프트',
                products: [
                    { name: '테스트 상품', brand: '테스트 브랜드', price: 50000, category: '상의', imageUrl: 'test.jpg' }
                ]
            };
            
            const id = styleHistoryManager.add(testStyle);
            document.getElementById('historyResults').innerHTML = 
                `<p class="text-green-400">✅ 히스토리 추가됨 (ID: ${id})</p>`;
        };
        
        window.showStyleHistory = function() {
            const history = styleHistoryManager.getAll();
            document.getElementById('historyResults').innerHTML = 
                `<p>총 ${history.length}개 히스토리</p>
                 <div class="mt-2 max-h-32 overflow-y-auto">
                    ${history.map((item, i) => 
                        `<p class="text-xs text-slate-300">${i+1}. ${new Date(item.timestamp).toLocaleString()}</p>`
                    ).join('')}
                 </div>`;
        };
        
        window.testWishlist = function() {
            const testProduct = {
                productUrl: 'https://test.com/product/' + Date.now(),
                name: '테스트 상품 ' + Date.now(),
                brand: '테스트 브랜드',
                price: 25000,
                imageUrl: 'test.jpg',
                category: '상의'
            };
            
            try {
                const id = wishlistManager.add(testProduct);
                document.getElementById('wishlistResults').innerHTML = 
                    `<p class="text-green-400">✅ 위시리스트 추가됨 (ID: ${id})</p>`;
            } catch (error) {
                document.getElementById('wishlistResults').innerHTML = 
                    `<p class="text-red-400">❌ ${error.message}</p>`;
            }
        };
        
        window.showWishlist = function() {
            const wishlist = wishlistManager.getAll();
            document.getElementById('wishlistResults').innerHTML = 
                `<p>총 ${wishlist.length}개 상품</p>
                 <div class="mt-2 max-h-32 overflow-y-auto">
                    ${wishlist.map((item, i) => 
                        `<p class="text-xs text-slate-300">${i+1}. ${item.name} (${item.price.toLocaleString()}원)</p>`
                    ).join('')}
                 </div>`;
        };
        
        window.testPreferences = function() {
            const updated = userPreferencesManager.update({
                theme: 'light',
                notifications: false,
                preferredCategories: ['상의', '하의']
            });
            
            document.getElementById('preferencesResults').innerHTML = 
                updated ? '<p class="text-green-400">✅ 설정 업데이트됨</p>' : 
                         '<p class="text-red-400">❌ 설정 업데이트 실패</p>';
        };
        
        window.showPreferences = function() {
            const prefs = userPreferencesManager.get();
            document.getElementById('preferencesResults').innerHTML = 
                `<div class="text-xs">
                    <p>테마: ${prefs.theme}</p>
                    <p>알림: ${prefs.notifications ? '켜짐' : '꺼짐'}</p>
                    <p>언어: ${prefs.language}</p>
                    <p>선호 카테고리: ${prefs.preferredCategories.join(', ')}</p>
                 </div>`;
        };
        
        window.showStorageInfo = function() {
            const quota = storageManager.getQuotaInfo();
            const cleanupResult = storageManager.cleanup();
            
            document.getElementById('storageInfo').innerHTML = 
                `<div class="space-y-2">
                    <p>사용 중: ${Math.round(quota.used / 1024)}KB</p>
                    <p>예상 가용: ${quota.available ? Math.round(quota.available / 1024) + 'KB' : '알 수 없음'}</p>
                    <p>정리 결과: ${cleanupResult ? '성공' : '실패'}</p>
                    <p class="text-green-400">✅ 모든 스토리지 기능 정상 작동</p>
                 </div>`;
        };
    </script>
</body>
</html>